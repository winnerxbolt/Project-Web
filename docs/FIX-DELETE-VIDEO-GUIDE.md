# üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "Failed to delete video"

## ‚úÖ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß

### **‡∏õ‡∏±‡∏ç‡∏´‡∏≤**: ‡∏Å‡∏î‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "Failed to delete video"

### **‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏**:
1. ‚ùå Service Role Key ‡πÉ‡∏ô `.env.local` ‡∏°‡∏µ typo (`"rose"` ‡πÅ‡∏ó‡∏ô `"role"`)
2. ‚ùå RLS (Row Level Security) Policies ‡πÉ‡∏ô Supabase ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏•‡∏ö
3. ‚ùå API route ‡πÑ‡∏°‡πà‡∏°‡∏µ error logging ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏û‡∏≠

---

## üõ†Ô∏è ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### **1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Service Role Key**
‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `.env.local` - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô JWT token ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### **2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç API Route** 
‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `/app/api/videos/route.ts`:
- ‡πÄ‡∏û‡∏¥‡πà‡∏° error logging ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
- ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á normal client ‡πÅ‡∏•‡∏∞ admin client (fallback)
- ‡∏™‡πà‡∏á error message ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

### **3. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Database Permissions**
‚úÖ ‡∏£‡∏±‡∏ô SQL script: `fix-videos-delete-permission.sql` ‡πÉ‡∏ô Supabase

---

## üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### **‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏£‡∏±‡∏ô SQL ‡πÉ‡∏ô Supabase**

1. ‡πÄ‡∏õ‡∏¥‡∏î Supabase Dashboard: https://supabase.com/dashboard
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Project ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
3. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **SQL Editor**
4. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å SQL ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå `fix-videos-delete-permission.sql`
5. ‡∏ß‡∏≤‡∏á (Paste) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å **Run**
6. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏™‡∏î‡∏á "Success"

**SQL ‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£:**
- ‡∏•‡∏ö policies ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏™‡∏£‡πâ‡∏≤‡∏á policies ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ:
  - ‚úÖ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà active ‡πÑ‡∏î‡πâ
  - ‚úÖ Authenticated users ‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö‡πÑ‡∏î‡πâ
  - ‚úÖ Service role ‡∏°‡∏µ full access

### **‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: Restart Next.js Server**

**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!** ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `.env.local` ‡∏ï‡πâ‡∏≠‡∏á restart server:

```bash
# ‡∏Å‡∏î Ctrl+C ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î server ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
# ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏£‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà:
npm run dev
```

### **‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠**

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `http://localhost:3000/admin/videos`
2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞ (üóëÔ∏è) ‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ
3. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
4. ‚úÖ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!

---

## üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### **1. ‡πÄ‡∏ä‡πá‡∏Ñ Browser Console**
1. ‡∏Å‡∏î F12 ‡πÄ‡∏õ‡∏¥‡∏î Developer Tools
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà tab **Console**
3. ‡∏•‡∏≠‡∏á‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
4. ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ error ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

**‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô:**
```
DELETE request received for video ID: xxx-xxx-xxx
Video deleted successfully: [...]
```

**‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô:**
```
Supabase delete error: { ... }
```

### **2. ‡πÄ‡∏ä‡πá‡∏Ñ Network Tab**
1. ‡∏Å‡∏î F12 ‡πÄ‡∏õ‡∏¥‡∏î Developer Tools
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà tab **Network**
3. ‡∏•‡∏≠‡∏á‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
4. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà request ‡∏ä‡∏∑‡πà‡∏≠ `videos?id=xxx`
5. ‡∏î‡∏π Response

**‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Status: 200):**
```json
{
  "success": true,
  "message": "Video deleted successfully"
}
```

**‡∏ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (Status: 500):**
```json
{
  "error": "Failed to delete video",
  "details": "..."
}
```

### **3. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô Supabase**
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Supabase Dashboard
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **Table Editor**
3. ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á **videos**
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡∏•‡∏ö‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏£‡∏¥‡∏á

---

## üêõ Troubleshooting

### **‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏¢‡∏±‡∏á‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô SQL**

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ô SQL script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
2. Restart Next.js server (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!)
3. Clear browser cache (Ctrl+Shift+Delete)
4. ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

### **‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Error "Video not found"**

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô database
2. ‡πÄ‡∏ä‡πá‡∏Ñ video ID ‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
3. Refresh ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö

### **‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Error "Permission denied"**

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ô SQL script ‡πÅ‡∏•‡πâ‡∏ß
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Service Role Key ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
3. Restart server ‡πÉ‡∏´‡∏°‡πà

### **‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Server ‡πÑ‡∏°‡πà reload env variables**

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
```bash
# Stop server (Ctrl+C)
# Delete .next folder
rm -rf .next  # ‡∏´‡∏£‡∏∑‡∏≠ rmdir /s .next ‡πÉ‡∏ô Windows

# Restart server
npm run dev
```

---

## üìä ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### **‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**

1. ‚úÖ `.env.local` - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Service Role Key
2. ‚úÖ `app/api/videos/route.ts` - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á DELETE method
3. ‚úÖ `fix-videos-delete-permission.sql` - SQL script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ permissions

### **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:**

- ‚úÖ Error logging ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
- ‚úÖ Check video exists ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
- ‚úÖ Fallback ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ admin client
- ‚úÖ Return error details ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

---

## ‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### **Test Case 1: ‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏õ‡∏Å‡∏ï‡∏¥**
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `/admin/videos`
2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ
3. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
4. **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ‚úÖ

### **Test Case 2: ‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà**
1. ‡πÉ‡∏ä‡πâ API endpoint: `DELETE /api/videos?id=invalid-id`
2. **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: Error 404 "Video not found" ‚úÖ

### **Test Case 3: ‡∏•‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô**
1. ‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ 2-3 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô
2. **‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**: ‡∏•‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚úÖ

---

## üéâ ‡∏™‡∏£‡∏∏‡∏õ

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß!**

- ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Service Role Key
- ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á API route ‡∏û‡∏£‡πâ‡∏≠‡∏° error handling
- ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Database permissions
- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° logging ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debugging

**‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:**
1. ‚úÖ ‡∏•‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô database
2. ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
3. ‚úÖ ‡∏°‡∏µ error handling ‡∏ó‡∏µ‡πà‡∏î‡∏µ
4. ‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏î‡πâ‡∏ß‡∏¢ confirmation dialog

---

## üìû Support

‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
1. ‡πÄ‡∏ä‡πá‡∏Ñ Console Log (F12)
2. ‡πÄ‡∏ä‡πá‡∏Ñ Network Tab
3. ‡πÄ‡∏ä‡πá‡∏Ñ Supabase Logs
4. Restart server ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà

**‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!** üöÄ
